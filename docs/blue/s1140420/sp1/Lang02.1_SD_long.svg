<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="756px" preserveAspectRatio="none" style="width:1194px;height:756px;" version="1.1" viewBox="0 0 1194 756" width="1194px" zoomAndPan="magnify"><defs><filter height="300%" id="fj5fyuoeiohfe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fj5fyuoeiohfe)" height="396.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="218" y="140.6953"/><rect fill="#FFFFFF" filter="url(#fj5fyuoeiohfe)" height="225.0625" style="stroke: #000000; stroke-width: 2.0;" width="745" x="293" y="155.6953"/><rect fill="#FFFFFF" filter="url(#fj5fyuoeiohfe)" height="106.5313" style="stroke: #000000; stroke-width: 2.0;" width="725" x="303" y="238.0938"/><rect fill="#FFFFFF" filter="url(#fj5fyuoeiohfe)" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="705" x="313" y="262.2266"/><rect fill="#FFFFFF" filter="url(#fj5fyuoeiohfe)" height="135.6641" style="stroke: #000000; stroke-width: 2.0;" width="571" x="612" y="394.7578"/><rect fill="#FFFFFF" filter="url(#fj5fyuoeiohfe)" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="396" x="622" y="477.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="33" x2="33" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="222.5" x2="222.5" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="390" x2="390" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="544" x2="544" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="668" x2="668" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="780" x2="780" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="972" x2="972" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1046" x2="1046" y1="38.2969" y2="715.9531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1128" x2="1128" y1="38.2969" y2="715.9531"/><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="15" y="22.9951">User</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="8" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="15" y="734.9482">User</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="187.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="194.5" y="22.9951">CellImpl</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="187.5" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="194.5" y="734.9482">CellImpl</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="323" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="330" y="22.9951">FormulaCompiler</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="323" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="330" y="734.9482">FormulaCompiler</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="467" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="474" y="22.9951">ExpressionCompiler</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="467" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="474" y="734.9482">ExpressionCompiler</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="632" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="639" y="22.9951">Formula</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="632" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="639" y="734.9482">Formula</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="715" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="722" y="22.9951">VariableWrapper</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="715" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="722" y="734.9482">VariableWrapper</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="936" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="943" y="22.9951">Variable</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="936" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="943" y="734.9482">Variable</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="1018" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="1025" y="22.9951">Block</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="1018" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="1025" y="734.9482">Block</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1084" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1091" y="22.9951">Attribution</text><rect fill="#FEFECE" filter="url(#fj5fyuoeiohfe)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1084" y="714.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1091" y="734.9482">Attribution</text><rect fill="#FFFFFF" filter="url(#fj5fyuoeiohfe)" height="396.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="218" y="140.6953"/><polygon fill="#A80036" points="211,65.4297,221,69.4297,211,73.4297,215,69.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="33" x2="217" y1="69.4297" y2="69.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="40" y="64.3638">Insert Block with Variables</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="223" x2="265" y1="98.5625" y2="98.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="265" x2="265" y1="98.5625" y2="111.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224" x2="265" y1="111.5625" y2="111.5625"/><polygon fill="#A80036" points="234,107.5625,224,111.5625,234,115.5625,230,111.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="230" y="93.4966">storeContent(content)</text><polygon fill="#A80036" points="378,136.6953,388,140.6953,378,144.6953,382,140.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="228" x2="384" y1="140.6953" y2="140.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="235" y="135.6294">compile(this,content)</text><path d="M293,155.6953 L370,155.6953 L370,162.6953 L360,172.6953 L293,172.6953 L293,155.6953 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="225.0625" style="stroke: #000000; stroke-width: 2.0;" width="745" x="293" y="155.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="308" y="168.7622">loop</text><polygon fill="#A80036" points="532.5,189.9609,542.5,193.9609,532.5,197.9609,536.5,193.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="390" x2="538.5" y1="193.9609" y2="193.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="397" y="188.895">getStarter()</text><polygon fill="#A80036" points="532.5,219.0938,542.5,223.0938,532.5,227.0938,536.5,223.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="390" x2="538.5" y1="223.0938" y2="223.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="397" y="218.0278">compile(cell,source)</text><path d="M303,238.0938 L380,238.0938 L380,245.0938 L370,255.0938 L303,255.0938 L303,238.0938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.5313" style="stroke: #000000; stroke-width: 2.0;" width="725" x="303" y="238.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="318" y="251.1606">loop</text><path d="M313,262.2266 L383,262.2266 L383,269.2266 L373,279.2266 L313,279.2266 L313,262.2266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="705" x="313" y="262.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="328" y="275.2935">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="398" y="274.437">[GRAMMAR_TOKEN == VARIABLE]</text><polygon fill="#A80036" points="768,296.4922,778,300.4922,768,304.4922,772,300.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="390" x2="774" y1="300.4922" y2="300.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="397" y="295.4263">create(cell, variableName)</text><polygon fill="#A80036" points="960,325.625,970,329.625,960,333.625,964,329.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="780" x2="966" y1="329.625" y2="329.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="787" y="324.5591">create(variableName, 0.0)</text><polygon fill="#A80036" points="656.5,368.7578,666.5,372.7578,656.5,376.7578,660.5,372.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="390" x2="662.5" y1="372.7578" y2="372.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="397" y="367.6919">create()</text><path d="M612,394.7578 L682,394.7578 L682,401.7578 L672,411.7578 L612,411.7578 L612,394.7578 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.6641" style="stroke: #000000; stroke-width: 2.0;" width="571" x="612" y="394.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="627" y="407.8247">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="697" y="406.9683">[GRAMMAR_TOKEN == LBRA]</text><polygon fill="#A80036" points="1034,429.0234,1044,433.0234,1034,437.0234,1038,433.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="668.5" x2="1040" y1="433.0234" y2="433.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="675.5" y="427.9575">applyTo (args)</text><polygon fill="#A80036" points="1116.5,458.1563,1126.5,462.1563,1116.5,466.1563,1120.5,462.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="668.5" x2="1122.5" y1="462.1563" y2="462.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="675.5" y="457.0903">applyTo (args)</text><path d="M622,477.1563 L692,477.1563 L692,484.1563 L682,494.1563 L622,494.1563 L622,477.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="396" x="622" y="477.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="637" y="490.2231">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="271" x="707" y="489.3667">[leftOperand instanceof VariableWrapper]</text><polygon fill="#A80036" points="960,511.4219,970,515.4219,960,519.4219,964,515.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="668.5" x2="966" y1="515.4219" y2="515.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="675.5" y="510.356">setVariableValue (rightOp.toDouble())</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="223" x2="265" y1="558.5547" y2="558.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="265" x2="265" y1="558.5547" y2="571.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224" x2="265" y1="571.5547" y2="571.5547"/><polygon fill="#A80036" points="234,567.5547,224,571.5547,234,575.5547,230,571.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="230" y="553.4888">updateDependencies()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="223" x2="265" y1="600.6875" y2="600.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="265" x2="265" y1="600.6875" y2="613.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224" x2="265" y1="613.6875" y2="613.6875"/><polygon fill="#A80036" points="234,609.6875,224,613.6875,234,617.6875,230,613.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="230" y="595.6216">removeDependent(this)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="223" x2="265" y1="642.8203" y2="642.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="265" x2="265" y1="642.8203" y2="655.8203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224" x2="265" y1="655.8203" y2="655.8203"/><polygon fill="#A80036" points="234,651.8203,224,655.8203,234,659.8203,230,655.8203" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="230" y="637.7544">fireContentChanged()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="223" x2="265" y1="684.9531" y2="684.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="265" x2="265" y1="684.9531" y2="697.9531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224" x2="265" y1="697.9531" y2="697.9531"/><polygon fill="#A80036" points="234,693.9531,224,697.9531,234,701.9531,230,697.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="230" y="679.8872">reevaluate()</text><!--
@startuml
participant "User" as User
participant "CellImpl" as CellImpl
participant "FormulaCompiler" as FormulaCompiler
participant "ExpressionCompiler" as ExpressionCompiler
participant "Formula" as Formula
participant "VariableWrapper" as VariableWrapper
participant "Variable" as Variable
participant "Block" as Block
participant "Attribution" as Attribution

User -> CellImpl : Insert Block with Variables
CellImpl->CellImpl : storeContent(content)
CellImpl->FormulaCompiler : compile(this,content)


activate CellImpl
loop
 FormulaCompiler->ExpressionCompiler : getStarter()
 FormulaCompiler->ExpressionCompiler : compile(cell,source)
    loop
        opt GRAMMAR_TOKEN == VARIABLE
         FormulaCompiler->VariableWrapper: create(cell, variableName)
         VariableWrapper->Variable : create(variableName, 0.0)
        end
    end
 FormulaCompiler->Formula : create()
end
opt GRAMMAR_TOKEN == LBRA
    Formula->Block : applyTo (args)
    Formula->Attribution : applyTo (args)
    opt leftOperand instanceof VariableWrapper
        Formula->Variable : setVariableValue (rightOp.toDouble())
    end
end
deactivate CellImpl


 CellImpl->CellImpl : updateDependencies()
 CellImpl->CellImpl : removeDependent(this)
 CellImpl->CellImpl : fireContentChanged()
 CellImpl->CellImpl : reevaluate()
@enduml

PlantUML version 1.2018.07beta8(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>